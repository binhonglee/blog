<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=0.75">
    
    <title>RESTful API with Spark Kotlin - BinHong Lee&#39;s Blog</title>
    
    <meta name="description" content="When speaking of building a backend API, the most common tools is either Spring Boot for Java or ExpressJS for JavaScript. Even for Kotlin, Spring Boot and JetBrain‚Äôs own ktor is the usual option to go with. But today I‚Äôll explore into the less popular option of spark-kotlin.
Disclaimer : I am not in anyway affiliated nor do I work at the project. I just simply stumbled upon it and started using it when working on a side project. (coming soon‚Ñ¢)">
    <meta property="og:type" content="article">
    <meta property="og:title" content="RESTful API with Spark Kotlin">
    <meta property="og:description" content="The not-so-mainstream way of building an API">
    <meta name="twitter:description" content="The not-so-mainstream way of building an API">
    <meta name="twitter:title" content="RESTful API with Spark Kotlin"><meta property="article:published_time" 2018-03-21T00:00:00-08:00 />
    <meta property="article:modified_time" 2018-03-21T00:00:00-08:00 />
    <meta property="og:image" content="https://binhong.me/blog/preview/spark_kotlin.jpg">
    <meta property="og:image:height" content="600">
    <meta property="og:image:width" content="1200">
    <meta name="twitter:image" content="https://binhong.me/blog/preview/spark_kotlin.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="max-image-preview:large">
    <meta name="image" content="https://binhong.me/blog/preview/spark_kotlin.jpg" />
    <meta name="twitter:site" content="@">
    <meta name="author" content="BinHong Lee">
    <meta property="og:profile:first_name" content="BinHong">
    <meta property="og:profile:last_name" content="Lee">
    <meta property="og:username" content="binhong">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="BinHong Lee&#39;s Blog">
    <meta name="twitter:site" content="@binhonglee">
    <meta name="fediverse:creator" content="@bh@social.lol">
    <link href="https://social.lol/@bh" rel="me">
    
    <link href="https://binhong.me/blog/style.css?v=1759946748080" rel="stylesheet">
    <link href="https://binhong.me/blog/darkMode.css?v=1754287594183" rel="stylesheet">
    <link href="https://binhong.me/blog/dark-syntax.css?v=1754290957202" rel="stylesheet">
    <link href="https://binhong.me/blog/light-syntax.css?v=1754290957202" rel="stylesheet">
    <link href="https://binhong.me/fonts/fonts.css?v=1761449005615" rel="stylesheet">
    <link href="https://binhong.me/threads/threads.css" rel="stylesheet">
    
    
    <link rel="icon" href="https://binhong.me/blog/img/profile.png" />
    
    <meta name="generator" content="Hugo 0.152.2">
    
    </head>
  <body class="single">
    <input class="dark_mode_toggle" type="checkbox" id="darkModeToggle">
    <div class="wrapper">
      <div class="content">
        <div class="dropdown">
          <button class="dropdown_toggle" aria-haspopup="true" aria-controls="dropdown_menu">+</button>
          <div class="header_links" id="dropdown_menu" aria-labelledby="dropdown_toggle" role="menu">
            <a class="link" href="https://binhong.me/" role="menuitem">About</a>
            <p>|</p>
            <a class="link" href="https://binhong.me/blog/" role="menuitem">Blog</a>
            <p>|</p>
            <div class="webring link" role="menuitem">
              <a class="webring_toggle">Webring</a>
              <div class="webring_links">
                <a class="link" href="https://ringdt.rapid.workers.dev/prev?from=https://binhong.me">Prev</a>
                <hr />
                <a class="link" href="https://ringdt.rapid.workers.dev/next?from=https://binhong.me">Next</a>    
              </div>
            </div>
          </div>
        </div>
        <div class="page_of_title">
          <div class="secondary_block">
            <p class="name-title">Blog</p>
          </div>
        </div>
        <div class="dark_mode_toggle_wrapper">
          <div class="toggle-container">
            <label for="darkModeToggle" class="toggle-label">
              <div class="background-layer day-bg"></div>
              <div class="background-layer night-bg"></div>
              
              <div class="toggle-slider">
                <div class="sun-rays"></div>
                <div class="moon-craters">
                  <div class="crater"></div>
                  <div class="crater"></div>
                  <div class="crater"></div>
                </div>
              </div>
              
              <div class="cloud cloud1"></div>
              <div class="cloud cloud2"></div>
              <div class="cloud cloud3"></div>
              <div class="cloud cloud4"></div>
              <div class="cloud cloud5"></div>
              
              <div class="star star1"></div>
              <div class="star star2"></div>
              <div class="star star3"></div>
              <div class="star star4"></div>
              <div class="star star5"></div>
              <div class="star star6"></div>
              <div class="star star7"></div>
              <div class="star star8"></div>
              <div class="star star9"></div>
              <div class="star star10"></div>
              <div class="star star11"></div>
              <div class="star star12"></div>
            </label>
          </div>
        </div>
      </div>


    <article class="content_body primary_block projects">
      <main class="article_body">
        <div class="active">
          <h1 class="row title">RESTful API with Spark Kotlin</h1>
          <p class="row subtitle">The not-so-mainstream way of building an API</p>
          <div class="row author">
            <p>BinHong Lee</p>
            <p class="right">March 21, 2018</p>
          </div>
          <div class="post_content"><p>When speaking of building a backend API, the most common tools is either Spring Boot for Java or ExpressJS for JavaScript. Even for Kotlin, Spring Boot and JetBrain‚Äôs own ktor is the usual option to go with. But today I‚Äôll explore into the less popular option of spark-kotlin.</p>
<p><em>Disclaimer : I am not in anyway affiliated nor do I work at the project. I just simply stumbled upon it and started using it when working on a side project. (coming soon‚Ñ¢)</em></p>
<a class="anchor" href="#understanding-rest">
    <h2 id="understanding-rest">
        <span class="text">Understanding REST</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>If you already know or built a RESTful API, you can skip this part. There are already quite a few <a href="http://www.looah.com/source/view/2284">guides</a> out there that goes into the specifics of what REST is and all the amazing things about it. So instead, I‚Äôll just cover the basics (more like, that‚Äôs all I know about it). It‚Äôs the standard way of communication on the internet through HTTP. In the world of internet, the frontend web interface needs a way to communicate with the backend. While the frontend can say all kinds of things, they still need to declare a set of standard ‚Äòphrases‚Äô between them so the backend knows what the frontend is asking for.</p>
<a class="anchor" href="#setting-up">
    <h2 id="setting-up">
        <span class="text">Setting up</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>Here are a few thing you might want to have installed before getting started:</p>
<ul>
<li>Maven / Gradle</li>
<li>Kotlin</li>
<li>Java? (not too sure but you‚Äôll probably need it)</li>
<li>(optional) IntelliJ</li>
</ul>
<a class="anchor" href="#getting-started">
    <h2 id="getting-started">
        <span class="text">Getting started</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>According to the <a href="https://github.com/perwendel/spark-kotlin">official GitHub repo of spark-kotlin</a>, here are the following things to include to use it for either Maven or Gradle. Personally, I‚Äôm using Gradle for this simply because I‚Äôve never used it outside of Android Development. (Also, its the new sexy thing. Kinda?)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>com.sparkjava<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spark-kotlin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.0.0-alpha<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">compile</span> <span class="s2">&#34;com.sparkjava:spark-kotlin:1.0.0-alpha&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#the-basics">
    <h2 id="the-basics">
        <span class="text">The basics</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>This is what attracted me to use it over spring-boot. It just looks so much easier and straightforward comparatively. Admittedly, I‚Äôve never used spring-boot for server development so I could be totally wrong especially if/when it comes down to a large scale application.</p>
<a class="anchor" href="#get-request">
    <h3 id="get-request">
        <span class="text">GET request</span>
        <span class="tag">#</span>
    </h3>
</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">spark.kotlin.*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Welcome to website abc.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>That‚Äôs it! I could‚Äôve just ended the article here and you can pretty much figure out the rest on your own. But yea, let‚Äôs explore into a few more interesting features.</p>
<a class="anchor" href="#post-request">
    <h3 id="post-request">
        <span class="text">POST request</span>
        <span class="tag">#</span>
    </h3>
</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">spark.kotlin.*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">post</span><span class="p">(</span><span class="s2">&#34;/checkExist&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">checkItem</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">checkItem</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="n">String</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">if</span><span class="p">(</span><span class="n">exists</span><span class="p">)</span> <span class="s2">&#34;Exists.&#34;</span> <span class="k">else</span> <span class="s2">&#34;Does not exist.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">exist</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="n">String</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Some check to make sure given string exist
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For POST request, they work as easily too! All you need to know is that the request body can be retrieved with <code>request.body()</code>.</p>
<a class="anchor" href="#more-fun-stuff">
    <h2 id="more-fun-stuff">
        <span class="text">More fun stuff</span>
        <span class="tag">#</span>
    </h2>
</a>
<a class="anchor" href="#redirect-params">
    <h3 id="redirect-params">
        <span class="text">redirect(), params()</span>
        <span class="tag">#</span>
    </h3>
</a>
<p>Now, what if you want to have the same output for separate links? Well, you can just do <code>redirect(&quot;/path&quot;)</code>. You can also get information from the URL through <code>params(&quot;:path&quot;)</code> tag. Something like this‚Ä¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">spark.kotlin.*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">post</span><span class="p">(</span><span class="s2">&#34;/checkExist&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">redirect</span><span class="p">(</span><span class="s2">&#34;/checkExist/&#34;</span> <span class="p">+</span> <span class="n">request</span><span class="p">.</span><span class="n">body</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">get</span><span class="p">(</span><span class="s2">&#34;/checkExist/:id&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">checkItem</span><span class="p">(</span><span class="n">params</span><span class="p">(</span><span class="s2">&#34;:id&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">checkItem</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="n">String</span><span class="p">):</span> <span class="n">String</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">exist</span><span class="p">(</span><span class="n">input</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Exist.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Does not exist.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">exist</span><span class="p">(</span><span class="n">input</span><span class="p">:</span><span class="n">String</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//Some check to make sure given string exist
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#instance-api">
    <h3 id="instance-api">
        <span class="text">Instance API</span>
        <span class="tag">#</span>
    </h3>
</a>
<p>You can also have a separate instance API that is running on a different port or with a different setting than the static API simply by declaring it as a separate variable.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">spark.kotlin.*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="py">http</span> <span class="p">=</span> <span class="n">ignite</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">port</span> <span class="p">=</span> <span class="m">4567</span>
</span></span><span class="line"><span class="cl">        <span class="n">ipAddress</span> <span class="p">=</span> <span class="s2">&#34;0.0.0.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">http</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Welcome to website abc.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">http</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;/404&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">status</span><span class="p">(</span><span class="m">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Page does not exist.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Of course, there are a lot of more advanced features (such as session, uri, etc.) that I did not cover. Feel free to explore them on your own following the <a href="https://github.com/perwendel/spark-kotlin/blob/master/README.md">README of the repo</a>.</p>
<hr>
<p>From here on out, I‚Äôm including some relevant but not exactly spark-kotlin stuff on it.</p>
<a class="anchor" href="#dealing-with-json">
    <h2 id="dealing-with-json">
        <span class="text">Dealing with JSON</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>In many (or most) occasions, both requests and responses will be in JSON format. Here‚Äôs where Google&rsquo;s <a href="https://github.com/google/gson">Gson library</a> comes in handy. It is really easy to use and had a wide range of support. I put together a simple example below to show how it is and can be used.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">com.google.gson.GsonBuilder</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Some codes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">val</span> <span class="py">json</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="s2">&#34;{</span><span class="se">\&#34;</span><span class="s2">id</span><span class="se">\&#34;</span><span class="s2">: 32151986,</span><span class="se">\&#34;</span><span class="s2">info</span><span class="se">\&#34;</span><span class="s2">: </span><span class="se">\&#34;</span><span class="s2">someWords</span><span class="se">\&#34;</span><span class="s2">}&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Creating the item from JSON
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">val</span> <span class="py">newItem</span><span class="p">:</span> <span class="n">Item</span> <span class="p">=</span> <span class="n">GsonBuilder</span><span class="p">().</span><span class="n">create</span><span class="p">().</span><span class="n">fromJson</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="n">Item</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Creating JSON string from item
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">print</span><span class="p">(</span><span class="n">GsonBuilder</span><span class="p">().</span><span class="n">setPrettyPrinting</span><span class="p">().</span><span class="n">create</span><span class="p">().</span><span class="n">toJson</span><span class="p">(</span><span class="n">newItem</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">data</span> <span class="k">class</span> <span class="nc">Item</span> <span class="p">(</span><span class="k">val</span> <span class="py">id</span><span class="p">:</span> <span class="n">Long</span><span class="p">,</span> <span class="k">val</span> <span class="py">info</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#unit-testing">
    <h2 id="unit-testing">
        <span class="text">Unit testing</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>It took me a while to find a testing library that works as easily as I wished. This is a test library made specifically for the spark framework by <a href="https://www.despegar.com/">Despegar</a> called <a href="https://github.com/despegar/spark-test">spark-test</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-kotlin" data-lang="kotlin"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">com.despegar.http.client.*</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">com.despegar.sparkjava.test.SparkServer</span>
</span></span><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">spark.servlet.SparkApplication</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">YourTest</span><span class="p">:</span> <span class="n">SparkApplication</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">override</span> <span class="k">fun</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">main</span><span class="p">(</span><span class="n">arrayOf</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">var</span> <span class="py">testServer</span><span class="p">:</span> <span class="n">SparkServer</span><span class="p">&lt;</span><span class="n">YourTest</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">SparkServer</span><span class="p">(</span><span class="n">YourTest</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">,</span> <span class="m">4567</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Tests</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">getTest</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">get</span><span class="p">:</span> <span class="n">GetMethod</span> <span class="p">=</span> <span class="n">testServer</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">var</span> <span class="py">httpResponse</span> <span class="p">=</span> <span class="n">testServer</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="k">get</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertEquals</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">code</span><span class="p">(),</span> <span class="m">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertEquals</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">body</span><span class="p">()),</span> <span class="s2">&#34;Welcome to website abc.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">get</span> <span class="p">=</span> <span class="n">testServer</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s2">&#34;/404&#34;</span><span class="p">,</span> <span class="k">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">httpResponse</span> <span class="p">=</span> <span class="n">testServer</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="k">get</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertEquals</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">code</span><span class="p">(),</span> <span class="m">404</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Test</span>
</span></span><span class="line"><span class="cl">    <span class="k">fun</span> <span class="nf">checkExistTest</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">post</span><span class="p">:</span> <span class="n">PostMethod</span> <span class="p">=</span> <span class="n">testServer</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&#34;/checkExist&#34;</span><span class="p">,</span> <span class="s2">&#34;someInput&#34;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">val</span> <span class="py">httpResponse</span> <span class="p">=</span> <span class="n">testServer</span><span class="p">.</span><span class="n">execute</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertEquals</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">code</span><span class="p">(),</span> <span class="m">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">assertEquals</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">.</span><span class="n">body</span><span class="p">()),</span> <span class="s2">&#34;Exist.&#34;</span><span class="p">)</span> <span class="c1">// or &#34;Does not exist.&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>A few things to keep in mind though:</p>
<ul>
<li>This is a Java library made for <a href="https://github.com/perwendel/spark">spark-java</a> instead of <a href="https://github.com/perwendel/spark-kotlin">spark-kotlin</a></li>
<li>The server needs to be running on the background (in my case, on port 4567) for this to work</li>
<li>Unable to attach a request body for DELETE request</li>
</ul>
<p><em>Note: As mentioned at the time of writing, the DELETE request is unable to attach any kind of request body to it making it hard to test your DELETE request. Personally, I use different URL each feature so I just redirect a POST request from the same url to the DELETE request and test it through the POST request instead. Not ideal, but it works for now.</em></p>
<hr>
<a class="anchor" href="#references">
    <h2 id="references">
        <span class="text">References</span>
        <span class="tag">#</span>
    </h2>
</a>
<ul>
<li><a href="https://medium.com/@codemwnci/kotlin-webapp-tutorial-todolist-part-1-c544b9a70f29">Kotlin WebApp Tutorial</a> by Wayne Ellis</li>
<li><a href="https://medium.com/@v.souhrada/build-rest-service-with-kotlin-spark-java-and-requery-part-1-1798844fdf04">Build REST Service with Kotlin, Spark Java and Requery</a> by Vaclav Souhrada</li>
</ul>
<blockquote>
<p><em>This article was originally published on <a href="https://hackernoon.com/restful-api-with-spark-kotlin-f43bd57affc4">Hacker Noon</a>.</em></p>
</blockquote>
</div>
          <div class="tags">
            üîñ
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/restful-api">RESTful API</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/kotlin">Kotlin</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/spark-kotlin">Spark Kotlin</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/api">API</a>
          </div>
        </div>        <div class="newsletter">
          <h2>Subscribe to the newsletter today!</h2>
          <form action="https://binhong.me/newsletter/subscribe" method="post">
              <input type="email" name="email" placeholder="email@domain.com"/>
              <noscript>
                <br />
                <label>You will need to manually get this secret from <a href="https://binhong.me/newsletter/secret">here</a></label>
                <input name="secret" placeholder="secret"/>
                <br />
              </noscript>
              <input type="hidden" name="secret" id="secret" value="123potato123"/>
              <button type="submit" name="submit" class="subscribe">Subscribe</button>
          </form>
          You can also checkout previous issues <a href="https://binhong.me/newsletter" target="_blank" style="text-decoration: underline;">here</a> before deciding.
        </div>
        <div class="bottom_buttons">
          
          
          
          <a href="/blog/2018-04-22-getting-started-with-travis-ci/">
            <div class="bottom_button">
              ‚Üê Next
              <br />
              <br />
              <span class="button_title">Getting started with Travis-CI</span>
            </div>
          </a>
          
          
          
          <a href="/blog/2018-02-10-being-lucky/">
            <div class="bottom_button previous_post">
              Previous ‚Üí
              <br />
              <br />
              <span class="button_title">Being lucky</span>
            </div>
          </a>
          
        </div>
      </main>
    </article>
      <footer class="content">
        <div class="footer primary_block">
          <div class="row">
            <p>Fonts:</p>
            <a href="http://vollkorn-typeface.com/" rel="noopener noreferrer nofollow" target="_blank" class="name">Vollkorn</a>,
            <a href="https://rubjo.github.io/victor-mono/" rel="noopener noreferrer nofollow" target="_blank" class="name">Victor Mono</a>
          </div>
          <div class="row">
            <p>
              <a href="https://github.com/binhonglee/blog/blob/main/content/2018-03-21-restful-api-with-spark-kotlin.md?plain=1" rel="noopener noreferrer nofollow" target="_blank">Source</a>
              |
              <a rel="alternate" type="application/rss+xml" href="https://binhong.me/blog/index.xml" title="BinHong Lee&#39;s Blog">RSS</a>
            </p>
          </div>
          <div class="row">
            <p>
              &copy; 2025 <a href="https://binhong.me">BinHong Lee</a>
            </p>
          </div>
          <div class="row">
            <p>
              Powered by <a href="https://gohugo.io/" rel="noopener noreferrer nofollow" target="_blank">Hugo</a>
            </p>
          </div>
        </div>
      </footer>
    </div>
    <script type="text/javascript" src="https://binhong.me/darkMode.js"></script>
    <script type="text/javascript" src="https://binhong.me/viewer.js"></script>
    <script type="text/javascript" src="https://binhong.me/blog/secret.js"></script>
  </body>
</html>

