<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=0.75">
    
    <title>Hosting your own Git server with Gitea - BinHong Lee&#39;s Blog</title>
    
    <meta name="description" content="Most people (including myself) host their personal projects on a third-party free Git hosting websites like GitHub, GitLab, Bitbucket etc. While that is sufficient for most people, it is also pretty fun to have your own Git service hosted on your own domain name of choice. While I trust my fellow engineers at these companies, I am using this as a personally backup to those services if anything goes wrong (like GitLab. Though to their credit, they were able to recover most of it).">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Hosting your own Git server with Gitea">
    <meta property="og:description" content="Having additional backups are never a bad idea">
    <meta name="twitter:description" content="Having additional backups are never a bad idea">
    <meta name="twitter:title" content="Hosting your own Git server with Gitea"><meta property="article:published_time" 2018-08-20T00:00:00-08:00 />
    <meta property="article:modified_time" 2018-08-20T00:00:00-08:00 />
    <meta property="og:image" content="https://binhong.me/blog/preview/own_git_server_gitea.jpg">
    <meta property="og:image:height" content="600">
    <meta property="og:image:width" content="1200">
    <meta name="twitter:image" content="https://binhong.me/blog/preview/own_git_server_gitea.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="max-image-preview:large">
    <meta name="image" content="https://binhong.me/blog/preview/own_git_server_gitea.jpg" />
    <meta name="twitter:site" content="@">
    <meta name="author" content="BinHong Lee">
    <meta property="og:profile:first_name" content="BinHong">
    <meta property="og:profile:last_name" content="Lee">
    <meta property="og:username" content="binhong">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="BinHong Lee&#39;s Blog">
    <meta name="twitter:site" content="@binhonglee">
    <meta name="fediverse:creator" content="@bh@social.lol">
    <link href="https://social.lol/@bh" rel="me">
    
    <link href="https://binhong.me/blog/style.css?v=1753151316008" rel="stylesheet">
    <link href="https://binhong.me/blog/dark-syntax.css?v=1748746674" rel="stylesheet">
    <link href="https://binhong.me/blog/light-syntax.css?v=1748746674" rel="stylesheet">
    <link href="https://binhong.me/fonts/fonts.css?v=1747738744" rel="stylesheet">
    <link href="https://binhong.me/threads/threads.css" rel="stylesheet">
    
    
    <link rel="icon" href="https://binhong.me/blog/img/profile.png" />
    
    <meta name="generator" content="Hugo 0.148.1">
    
    </head>
  <body class="single">
    <details class="dark_mode_toggle" role="button" open>
      <summary>
        <div class="content">
          <div class="secondary_block">
            <p class="name-title">Blog</p>
          </div>
        </div>
      </summary>
    </details>
    <div class="wrapper">
      <div class="content dropdown">
        <button class="dropdown_toggle" aria-haspopup="true" aria-controls="dropdown_menu">+</button>
        <div class="header_links" id="dropdown_menu" aria-labelledby="dropdown_toggle" role="menu">
          <a class="link" href="https://binhong.me/" role="menuitem">About</a>
          <p>|</p>
          <a class="link" href="https://binhong.me/blog/" role="menuitem">Blog</a>
          <p>|</p>
          <div class="webring link" role="menuitem">
            <a class="webring_toggle">Webring</a>
            <div class="webring_links">
              <a class="link" href="https://ringdt.rapid.workers.dev/prev?from=https://binhong.me">Prev</a>
              <hr />
              <a class="link" href="https://ringdt.rapid.workers.dev/next?from=https://binhong.me">Next</a>    
            </div>
          </div>
        </div>
      </div>


    <article class="content_body primary_block projects">
      <main class="article_body">
        <div class="active">
          <h1 class="row title">Hosting your own Git server with Gitea</h1>
          <p class="row subtitle">Having additional backups are never a bad idea</p>
          <div class="row author">
            <p>BinHong Lee</p>
            <p class="right">August 20, 2018</p>
          </div>
          <div class="post_content"><p>Most people (including myself) host their personal projects on a third-party free Git hosting websites like GitHub, GitLab, Bitbucket etc. While that is sufficient for most people, it is also pretty fun to have your own Git service hosted on your own domain name of choice. While I trust my fellow engineers at these companies, I am using this as a personally backup to those services if anything goes wrong (<a href="https://about.gitlab.com/2017/02/01/gitlab-dot-com-database-incident/">like GitLab</a>. Though to their credit, they were able to <a href="https://about.gitlab.com/2017/02/10/postmortem-of-database-outage-of-january-31/">recover most of it</a>).</p>
<a class="anchor" href="#requirements">
    <h2 id="requirements">
        <span class="text">Requirements</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>There really isn&rsquo;t much requirements except for a working machine and a proper working network. Preferably, you would be hosting this on a Virtual Private Server (DigitalOcean, Vultr, Linode etc.). However, you can also mess around with it on your own machine (it takes and requires very little resources by itself) or even host it at home on a Raspberry Pi!</p>
<a class="anchor" href="#installation">
    <h2 id="installation">
        <span class="text">Installation</span>
        <span class="tag">#</span>
    </h2>
</a>
<p><em>Referenced from <a href="https://docs.gitea.io/en-us/install-from-binary/">Gitea&rsquo;s own documentation</a></em></p>
<p>While there is a Gitea package in Debian&rsquo;s contrib (which most popular Linux OS such as Ubuntu and Mint based itself on), it doesn&rsquo;t seem it was maintained by the Gitea folks themselves so I wouldn&rsquo;t advice using it. Instead, the instructions below will provide an easy way to just download and run it with binary.</p>
<a class="anchor" href="#database">
    <h2 id="database">
        <span class="text">Database</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>You&rsquo;ll need a database to maintain all the information of user accounts and such. Gitea comes with support for SQLite, MySQL and PostgreSQL out of the box so you can pick either of those that you are familiar with to go with. Personally I picked PostgreSQL as I&rsquo;ve always wanted to learn how to mess with one.
In your choice of database, you should create a user (preferably only specifically for the use of Gitea) and a database for Gitea. You will need to fill out these credentials later when setting up Gitea.</p>
<a class="anchor" href="#gitea">
    <h2 id="gitea">
        <span class="text">Gitea</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>As Gitea calls itself &lsquo;a painless self-hosted Git service&rsquo;, the setup is indeed very straightforward. Simply download and run it depending on they way you want to do it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">wget -O gitea https://dl.gitea.io/gitea/1.5.0/gitea-1.5.0-linux-amd64
</span></span><span class="line"><span class="cl">chmod +x gitea
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>Optionally</em>, you can also verify the GPG signature of the downloaded file with Gitea&rsquo;s <a href="https://pgp.mit.edu/pks/lookup?op=vindex&amp;fingerprint=on&amp;search=0x2D9AE806EC1592E2">GPG key</a> for security purposes before running it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">gpg --keyserver pgp.mit.edu --recv 0x2D9AE806EC1592E2
</span></span><span class="line"><span class="cl">gpg --verify gitea-1.5.0-linux-amd64.asc gitea-1.5.0-linux-amd64
</span></span></code></pre></td></tr></table>
</div>
</div><p>To run Gitea, it is as simple as the following…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">./gitea web
</span></span></code></pre></td></tr></table>
</div>
</div><p>By default, it will be running on port::3000 of the device IP (http://localhost:3000/). In case you prefer running Gitea from source, they also have <a href="https://docs.gitea.io/en-us/install-from-source/">specific documentations</a> for that. I had a lot of troubles trying to set it up myself so YMMV.</p>
<a class="anchor" href="#load-balancer-optional">
    <h2 id="load-balancer-optional">
        <span class="text">Load Balancer (Optional)</span>
        <span class="tag">#</span>
    </h2>
</a>
<p><em>Referenced from <a href="https://docs.gitea.io/en-us/reverse-proxies/">Gitea&rsquo;s own documentation</a></em></p>
<p>If you are running this on a remote server (especially if you are also hosting a bunch of other stuffs), you will need to use a load balance (like Apache HTTPD or NGINX) to forward a specific domain to the port. Append your configuration file with the following as you see fit.</p>
<a class="anchor" href="#apache-httpd">
    <h4 id="apache-httpd">
        <span class="text">Apache HTTPD</span>
        <span class="tag">#</span>
    </h4>
</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-apache" data-lang="apache"><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyPreserveHost</span> <span class="k">On</span>
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyRequests</span> <span class="k">off</span>
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyPass</span> / http://localhost:3000/
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyPassReverse</span> / http://localhost:3000/
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#nginx">
    <h4 id="nginx">
        <span class="text">NGINX</span>
        <span class="tag">#</span>
    </h4>
</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">git.example.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://localhost:3000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#configuration">
    <h2 id="configuration">
        <span class="text">Configuration</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>Open your browser and navigate to the wherever Gitea was hosted. In there, you will be filling out the database settings as you have configured above (for PostgreSQL, it should be on <code>127.0.0.1:5432</code>, not sure about the others).</p>
<p>Few things to look out for:</p>
<ul>
<li><code>Domain / Application URL</code> - This is important to be set up properly as they are used for SSH and HTTPS connection when it comes to cloning and pushing.</li>
<li><code>Disable Self-registration</code> - Considering that you are probably setting this up only for your own use, you should select this option so random people wouldn&rsquo;t just sign up and host projects on your server.</li>
<li><code>Admin username and password</code> - Since you have disabled self registration, you should then set this up in here and use it as your primary account. If you are concerned about security, you can also use the admin account to setup a day-to-day use account so in case the day-to-day account is compromised, you still retain full control of the server through your admin account.</li>
</ul>
<a class="anchor" href="#usage">
    <h2 id="usage">
        <span class="text">Usage</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>For the most part, I&rsquo;m using this as a backup to my projects hosted on GitHub and GitLab (project pages is an amazing feature) so ideally, I am mirroring most (if not all) of my projects. As part of being a mirrored repository, Gitea will periodically check the source repository for updates so you don&rsquo;t have to manually sync them. That said, I have quite a few projects that I moved away from mirroring and I&rsquo;ll talk about why below.</p>
<a class="anchor" href="#maintenance">
    <h2 id="maintenance">
        <span class="text">Maintenance</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>In case where your VPS (or Raspberry Pi) might restart constantly or so, it might be a chore to always manually start the service every time it is restarted. You should then consider configuring Gitea to run as a service (<a href="https://docs.gitea.io/en-us/linux-service/">Ubuntu</a>, <a href="https://docs.gitea.io/en-us/windows-service/">Windows</a>).</p>
<hr>
<a class="anchor" href="#droneio">
    <h2 id="droneio">
        <span class="text">Drone.io</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>When talking about the topic of Git, its hard to stay away from CI. It is such a great idea of automation that saves so much pain and problem especially if it is a huge project that takes a lot of resources and hard to run the tests locally. Here, I&rsquo;ll talk about <a href="https://drone.io">drone.io</a> which can also be self-hosted along with your Gitea server.</p>
<a class="anchor" href="#requirements-1">
    <h2 id="requirements-1">
        <span class="text">Requirements</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>You will need to have <a href="https://www.docker.com/">docker</a> installed in your machine as drone as a whole relies quite a bit on docker to work. The machine where drone is hosted will also require quite a bit of memory and processing power as running CI can be quite a chore for servers.</p>
<a class="anchor" href="#installation-1">
    <h2 id="installation-1">
        <span class="text">Installation</span>
        <span class="tag">#</span>
    </h2>
</a>
<p><em>Referenced from <a href="http://docs.drone.io/installation/">drone&rsquo;s own documentation</a></em></p>
<p>First, get the docker image for drone.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull drone/drone:0.8
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next, create a file named <code>docker-compose.yaml</code> and fill in the following.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">drone-server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">drone/drone:0.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">8000</span><span class="p">:</span><span class="m">8000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">9000</span><span class="p">:</span><span class="m">9000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/var/lib/drone:/var/lib/drone/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_OPEN=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_HOST=http://drone.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_GITEA=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_GITEA_URL=http://git.example.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_SECRET=${DRONE_SECRET}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">drone-agent</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">drone/agent:0.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">agent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">drone-server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/var/run/docker.sock:/var/run/docker.sock</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_SERVER=drone-server:9000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_SECRET=${DRONE_SECRET}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_DATABASE_DRIVER:postgres</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DRONE_DATABASE_DATASOURCE:postgres://root:password@1.2.3.4:5432/postgres?sslmode=disable</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Few things to keep in mind in the file above:</p>
<ul>
<li><code>DRONE_SECRET</code> - This is a secret string of your choice used for authentication purpose.</li>
<li><code>DRONE_HOST</code> - URL where this drone server is hosted.</li>
<li><code>DRONE_GITEA_URL</code> - Link to your Gitea server location (it can also be <code>http://localhost:3000/</code> link)</li>
<li><code>DRONE_DATABASE_DRIVER</code> - Database setup is <strong>optional</strong>. In their <a href="http://docs.drone.io/database-settings/">documentation</a>, they mention the setup process of MySQL and PostgreSQL. Though do note that their documentation doesn&rsquo;t seems to be accurate at least <a href="https://github.com/drone/docs/pull/360">from my experience</a> setting it up.</li>
</ul>
<p>In the same directory run the following and drone will be running on <code>http://localhost:8000/</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker-compose up
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#load-balancer-optional-1">
    <h2 id="load-balancer-optional-1">
        <span class="text">Load Balancer (Optional)</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>Similarly, if this is hosted on a remote server, you will have to add the following with the load balancer of your choice.</p>
<a class="anchor" href="#apache-httpd-1">
    <h4 id="apache-httpd-1">
        <span class="text">Apache HTTPD</span>
        <span class="tag">#</span>
    </h4>
</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-apache" data-lang="apache"><span class="line"><span class="cl"><span class="nt">&lt;VirtualHost</span> <span class="s">*:80</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyPreserveHost</span> <span class="k">On</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">RequestHeader</span> set X-Forwarded-Proto <span class="s2">&#34;https&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyPass</span> / http://127.0.0.1:8000/
</span></span><span class="line"><span class="cl">    <span class="nb">ProxyPassReverse</span> / http://127.0.0.1:8000/
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/VirtualHost&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#nginx-1">
    <h4 id="nginx-1">
        <span class="text">NGINX</span>
        <span class="tag">#</span>
    </h4>
</a>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">drone.example.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="nv">$scheme</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$http_host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><a class="anchor" href="#usage-1">
    <h2 id="usage-1">
        <span class="text">Usage</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>As mentioned, drone relies on docker not only for its installation but also running the CI itself. Each repository that you want to configure for drone should have to have a <code>.drone.yml</code> file like below at the top level of the repository. </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">pipeline</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">node:${NODE_VERSION}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">commands</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">npm install</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">npm run test</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">matrix</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">NODE_VERSION</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;7&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;6&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="s2">&#34;4&#34;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Few things to pay attention to in the sample file:</p>
<ul>
<li><code>image</code> - Drone supports any docker images available for download. You can look for available docker images at the Docker Hub.</li>
<li><code>matrix</code> - Like the scenario above, you want to test the project in multiple environments but doesn&rsquo;t want to retype most of the stuffs, you can use matrix as a variable to hold all the different versions you would like to run tests on.</li>
<li><code>commands</code> - This is the list of commands to run for the test to take place. You should also include installation of project dependent packages (such as <code>mvn install</code>, <code>npm install</code>, <code>bundle install</code> etc).</li>
</ul>
<hr>
<a class="anchor" href="#personal-notes">
    <h2 id="personal-notes">
        <span class="text">Personal Notes</span>
        <span class="tag">#</span>
    </h2>
</a>
<a class="anchor" href="#mirrored-repositories">
    <h4 id="mirrored-repositories">
        <span class="text">Mirrored Repositories</span>
        <span class="tag">#</span>
    </h4>
</a>
<p>Currently from my own experimentation, adding new commits to mirrored repositories (which are read-only) that are mainly hosted elsewhere would not trigger drone to run CI. Therefore, if you were to run drone on your own server, you can either enable it directly with the origin of the repository mirror or push twice to 2 separate servers for every commit. I&rsquo;m still looking for a solution for this so hopefully there&rsquo;s a better way than that.</p>
<a class="anchor" href="#memory-issues">
    <h4 id="memory-issues">
        <span class="text">Memory issues</span>
        <span class="tag">#</span>
    </h4>
</a>
<p>Some of these instances can take quite a bit of memory spaces to run. Personally, I am hosting this on a 256MB VPS squeezing it with a bunch of other stuffs I hosts. This actually causes an issue where the tests cannot be run properly. As seen <a href="https://drone.binhong.me/binhong/LibrarySystem/3/3">here</a>, at the end of the <code>build</code> log, it was just abruptly &lsquo;Killed&rsquo; and ended there and then with no further information. I am still working on investigating this but it is very likely due to the lack of remaining unused memory space on the VPS.</p>
<a class="anchor" href="#static-ip">
    <h4 id="static-ip">
        <span class="text">Static IP</span>
        <span class="tag">#</span>
    </h4>
</a>
<p>In case you are hosting this on a Raspberry Pi at home for personal use, you would want to set a static IP direction on your router. This would help make sure that when in your network, you can always connect to the device through the same IP.</p>
<a class="anchor" href="#nginx-2">
    <h4 id="nginx-2">
        <span class="text">NGINX</span>
        <span class="tag">#</span>
    </h4>
</a>
<p><del>I did not go deep into either of the load balancers in here as I am currently working on a separate piece that will focus more onto the configuration and use of NGINX to hosting multiple domain names and &lsquo;servers&rsquo;. Keep a look out for that!</del></p>
<p><em>You can read more about NGINX on my next post <a href="http://localhost:1313/blog/2018-08-29-how-to-host-multiple-domain-names-and-projects-on-one-server/">here</a>.</em></p>
<hr>
<a class="anchor" href="#references">
    <h2 id="references">
        <span class="text">References</span>
        <span class="tag">#</span>
    </h2>
</a>
<ul>
<li><a href="http://bryangilbert.com/post/devops/how-to-setup-gitea-ubuntu/">How to Setup Gitea on an Ubuntu Server</a> by <a href="http://bryangilbert.com/">Bryan Gilbert</a></li>
<li><a href="https://www.slideshare.net/appleboy/introduction-to-gitea-with-drone">Introduction to Gitea with Drone</a> by <a href="https://www.slideshare.net/appleboy">Bo-Yi Wu</a></li>
</ul>
<blockquote>
<p><em>This article was originally published on <a href="https://codeburst.io/hosting-your-own-git-server-with-gitea-fc3298aa15ce">codeburst.io</a>.</em></p></blockquote>
</div>
          <div class="tags">
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/git">Git</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/gitea">Gitea</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/continuous-integration">Continuous Integration</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/self-hosted">Self Hosted</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/devops">DevOps</a>
          </div>
        </div>        <div class="newsletter">
          <h2>Subscribe to the newsletter today!</h2>
          <form action="https://binhong.me/newsletter/subscribe" method="post">
              <input type="email" name="email" placeholder="email@domain.com"/>
              <noscript>
                <br />
                <label>You will need to manually get this secret from <a href="https://binhong.me/newsletter/secret">here</a></label>
                <input name="secret" placeholder="secret"/>
                <br />
              </noscript>
              <input type="hidden" name="secret" id="secret" value="123potato123"/>
              <button type="submit" name="submit" class="subscribe">Subscribe</button>
          </form>
          <br />
          You can also checkout previous issues <a href="https://binhong.me/newsletter" target="_blank" style="text-decoration: underline;">here</a> before deciding.
        </div>
        <div class="bottom_buttons">
          
          
          
          <a href="/blog/2018-08-29-how-to-host-multiple-domain-names-and-projects-on-one-server/">
            <div class="bottom_button">
              ← Next
              <br />
              <br />
              <span class="button_title">How to host multiple domain names and projects on one server</span>
            </div>
          </a>
          
          
          
          <a href="/blog/2018-06-02-building-a-side-project-over-the-weekend/">
            <div class="bottom_button previous_post">
              Previous →
              <br />
              <br />
              <span class="button_title">Building a side project over the weekend</span>
            </div>
          </a>
          
        </div>
      </main>
    </article>
      <footer class="content">
        <div class="footer primary_block">
          <div class="row">
            <p>Fonts:</p>
            <a href="http://vollkorn-typeface.com/" rel="noopener noreferrer nofollow" target="_blank" class="name">Vollkorn</a>,
            <a href="https://rubjo.github.io/victor-mono/" rel="noopener noreferrer nofollow" target="_blank" class="name">Victor Mono</a>
          </div>
          <div class="row">
            <p>
              <a href="https://github.com/binhonglee/blog/blob/main/content/2018-08-20-hosting-your-own-git-server-with-gitea.md?plain=1" rel="noopener noreferrer nofollow" target="_blank">Source</a>
              |
              <a rel="alternate" type="application/rss+xml" href="https://binhong.me/blog/index.xml" title="BinHong Lee&#39;s Blog">RSS</a>
            </p>
          </div>
          <div class="row">
            <p>
              &copy; 2025 <a href="https://binhong.me">BinHong Lee</a>
            </p>
          </div>
          <div class="row">
            <p>
              Powered by <a href="https://gohugo.io/" rel="noopener noreferrer nofollow" target="_blank">Hugo</a>
            </p>
          </div>
        </div>
      </footer>
    </div>
    <script type="text/javascript" src="https://binhong.me/darkMode.js"></script>
    <script type="text/javascript" src="https://binhong.me/blog/secret.js"></script>
  </body>
</html>

