<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>How to host multiple domain names and projects on one server - The Ink Mortar</title><meta name=description content="I own multiple domain names, and each one hosts a different side project. For the longest time, everything that required ‘hosting’ was hosted on Heroku. But their free tier can be quite limited, it can also get costly quickly if you are paying for each separate project. So instead, I decided to explore putting all of them together using NGINX (recommended to me by Jane Manchun Wong).
Required Resources Virtual Private Server (VPS) You’ll need a virtual server such as DigitalOcean or EC2 by AWS."><meta name=author content="BinHong Lee"><link href=https://binhong.me/blog/an-old-hope.min.css rel=stylesheet><link href=https://binhong.me/blog/style.css rel=stylesheet><link href=https://binhong.me/blog/custom.css rel=stylesheet><link rel=icon href=https://binhong.me/blog/img/profile.png><meta name=generator content="Hugo 0.85.0"><script>const key='dark-theme',dark='dark',light='light';function setTheme(){localStorage.getItem(key)?localStorage.getItem(key)===dark&&document.body.classList.add(dark):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add(dark)}function toggleDarkMode(){const b=localStorage.getItem(key);var a=dark;b===a&&(a=light),localStorage.setItem(key,a),document.body.classList.toggle(dark)}</script></head><body class=single><script>setTheme()</script><header class=header><nav class=nav><h1 class=logo><a href=https://binhong.me/blog/>The Ink Mortar</a></h1><button class=dark-mode-toggle onclick=toggleDarkMode()><h4 class=bright-text>Bright</h2><h4 class=dark-text>Dark</h2></button></nav></header><main class=main><article class=post-single><a href=https://binhong.me/blog/img/nginx.jpeg><img class=post-thumbnail-img src=https://binhong.me/blog/img/nginx.jpeg></a><div class=post-single-content><header class=post-header><h1 class=post-title>How to host multiple domain names and projects on one server</h1><h2 class=post-subtitle>NGINX is one magical tool</h2><div class=post-meta>BinHong Lee · August 29, 2018</div></header><div class=post-content><p>I own multiple domain names, and each one hosts a different side project. For the longest time, everything that required ‘hosting’ was hosted on Heroku. But their free tier can be quite limited, it can also get costly quickly if you are paying for each separate project. So instead, I decided to explore putting all of them together using NGINX (recommended to me by <a href=https://jmw.fyi>Jane Manchun Wong</a>).</p><h2 id=required-resources>Required Resources</h2><h4 id=virtual-private-server-vps>Virtual Private Server (VPS)</h4><p>You’ll need a virtual server such as DigitalOcean or EC2 by AWS. Personally I uses <a href="https://www.vultr.com/?ref=7358373">Vultr</a> (here’s the <a href=http://vultr.com/>non-referral link</a>) which costs me about $2.50 / month.</p><h4 id=domain-names>Domain Names</h4><p>You will need to register a few domain names. Assuming that you probably already have them, make sure your domain names are pointing at the name servers of your VPS. There should be a DNS section in your domain name service dashboard where you can select “custom DNS” or something similar. If you are not sure what the nameservers of your VPS are, you should be able to find that info easily through a simple search of “nameserver” + VPS service name.</p><h2 id=setting-up-nginx>Setting up NGINX</h2><h4 id=installation-and-basic-setup>Installation and basic setup</h4><p><em>Reference from <a href=https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-16-04>How To Install Nginx on Ubuntu 16.04</a></em></p><p>Run the following commands through SSH-ing into the VPS. It will install NGINX, set firewall rules allowing it, and set NGINX to autostart on boot.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo apt-get update
sudo apt-get install nginx
sudo ufw allow <span style=color:#e6db74>&#39;Nginx HTTP&#39;</span>
sudo systemctl enable nginx
</code></pre></div><h4 id=configuration-setup>Configuration setup</h4><p><em>Reference from <a href=https://geekflare.com/multiple-domains-on-one-server-with-apache-nginx/>Host Multiple Domains on One Server/IP with Apache or nginx</a></em></p><p>The default virtual.conf location should be at /etc/nginx/conf.d/virtual.conf. I recommend backing up the default file before making any changes. (If it doesn’t exist, you can just create it.) Edit the file to look something like the following:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
    <span style=color:#f92672>root</span> <span style=color:#e6db74>/opt/htdocs/binhong</span>;
    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>binhong.me</span>;
    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
    }
}

<span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
    <span style=color:#f92672>root</span> <span style=color:#e6db74>/opt/htdocs/breakups</span>;
    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>breakups.life</span>;
    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
        <span style=color:#f92672>try_files</span> $uri $uri/ =<span style=color:#ae81ff>404</span>;
    }
}

<span style=color:#66d9ef>server</span> {
    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
    <span style=color:#f92672>root</span> <span style=color:#e6db74>/opt/htdocs/breakupsAPI</span>;
    <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span> <span style=color:#e6db74>index.htm</span>;
    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>api.breakups.life</span>;
    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
        <span style=color:#f92672>proxy_redirect</span> <span style=color:#e6db74>http://127.0.0.1:8080/</span>;
    }
}
</code></pre></div><p>Here are a few things to look at:</p><ul><li><em>server</em> block — Each of these should represent each different domain or subdomain in use.</li><li><em>root</em> — This is the location where the (HTML) files are loaded from.</li><li><em>server_name</em> — (sub)domain name(s) that should load these specific files.</li><li><em>proxy_redirect</em> — in cases where you are redirecting a specific subdomain to an active server, you will want to add this and put the IP location after it. (For local servers, either <em>http://127.0.0.1:port</em> or <em>http://localhost:port</em> should work as intended.)</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo systemctl restart nginx
</code></pre></div><p>After you are done, restart the server so the new configurations will be loaded and applied.</p><h2 id=cloning-and-linking>Cloning and linking</h2><p>Now remember, since you have your directory pointing at /opt/htdocs/<em>websiteName</em>, your initial thought might be to clone your projects into these folders. This can work, but it’s not ideal since many operations in these folders require root access to really do anything.</p><p>Instead, you can clone them into your user folder or anywhere else like you normally would, and then create a soft link to connect the path to your repository folder. Something like this:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>git clone git@github.com:binhonglee/binhonglee.github.io ~/website
sudo ln -s ~/website /opt/htdocs/binhong
</code></pre></div><p>Of course, when you are cloning a Node.js static site folder (ReactJS, Angular or Vue.js), you will want to install (<code>npm install</code>) and build (<code>npm run-script build</code>) them. Then link the <em>./build</em> folder instead of the base level of the cloned repository. (Similarly for Jekyll sites, but use the <em>./_output</em> folder instead.) As for active servers, just make sure your server is running on the same port as it is listed in the configuration file.</p><h2 id=set-up-https-with-certbot>Set up HTTPS with certbot</h2><p>Thanks to Let’s Encrypt, you can now get free and easy HTTPS certificates. With the introduction of certbot, everything just got even easier!</p><p><em>Reference from <a href=https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-16-04>How To Secure Nginx with Let’s Encrypt on Ubuntu 16.04</a></em></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo add-apt-repository ppa:certbot/certbot
sudo apt-get update
sudo apt-get install python-certbot-nginx
sudo certbot --nginx -d binhong.me -d www.binhong.me -d api.breakups.life -d breakups.life -d www.breakups.life
</code></pre></div><p>Just run the above for all your domain and subdomain names and certbot will take care of everything. If you were to renew the certs, you can run the following so the certbot will help you renew your SSL certificate.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo certbot renew --dry-run
</code></pre></div><h2 id=updating-everything>Updating everything</h2><p>Now that you have everything up and running, you might be thinking, well there seems to be an awful lot to remember if/when I need to update something. Unfortunately, that’s kinda true, but we can always make it easier by adding a script that does it for us.</p><p>Here is how one would look:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># Update SSL certificates</span>
sudo certbot renew

killall screen

<span style=color:#75715e># normal html websites</span>
cd websiteSource
git pull
cd ../

<span style=color:#75715e># node.js static site</span>
cd nodeProjectFolder
git pull
npm install
npm run-script build
cd ../

<span style=color:#75715e># ruby jekyll site</span>
cd jekyllFolder
git pull
bundle install
bundle exec jekyll build
cd ../

<span style=color:#75715e># node.js server</span>
<span style=color:#75715e># make sure to stop the existing session before going ahead to start a new one</span>
cd nodeServer
git pull
screen -dmS nodeServer
npm install
screen -S nodeServer -X stuff <span style=color:#e6db74>&#34;cd ~/nodeServer
</span><span style=color:#e6db74>&#34;</span>
screen -S nodeServer -X stuff <span style=color:#e6db74>&#34;npm start
</span><span style=color:#e6db74>&#34;</span>
cd ../
</code></pre></div><p>Thanks for reading! Let me know if you have any questions in the comments below.</p><h2 id=about-me>About me</h2><p>At the time of writing, I work at Apple Inc. in the role of Siri Language Engineer as an Independent Contractor through AdvantisGlobal. I spend a lot of my free time experimenting and building new things with technologies I find fun and interesting. Follow my exploration journey <a href=https://binhong.me/blog>here</a> or on <a href=https://github.com/binhonglee>GitHub</a>.</p><hr><h2 id=other-references>Other References</h2><ul><li><a href=https://serverfault.com/questions/363159/nginx-proxy-pass-redirects-ignore-port>nginx proxy pass redirects ignore port</a> on <a href=https://serverfault.com/>serverfault</a></li><li><a href=https://superuser.com/questions/632205/continue-ssh-background-task-jobs-when-closing-ssh>Continue SSH background task/jobs when closing SSH</a> on <a href=https://superuser.com/>superuser</a></li></ul><blockquote><p><em>This article was originally published on <a href=https://medium.freecodecamp.org/how-you-can-host-multiple-domain-names-and-projects-in-one-vps-7aed4f56e7a1>freeCodeCamp Medium</a>.</em></p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=https://binhong.me/blog/tags/git>Git</a></li><li><a href=https://binhong.me/blog/tags/gitea>Gitea</a></li><li><a href=https://binhong.me/blog/tags/continuous-integration>Continuous Integration</a></li><li><a href=https://binhong.me/blog/tags/self-hosted>Self Hosted</a></li><li><a href=https://binhong.me/blog/tags/devops>DevOps</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://binhong.me/blog/>The Ink Mortar</a> by BinHong Lee</span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</span>
<span>&#183;</span>
<span>Theme️ <a href=https://github.com/binhonglee/CustomPaper rel=noopener target=_blank>CustomPaper</a></span></footer><script src=https://binhong.me/blog/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script></body></html>