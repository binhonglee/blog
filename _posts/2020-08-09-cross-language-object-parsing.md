---
layout: post
title: Cross Language Object Parsing
subtitle: "I wrote code that writes code"
feature-img: "assets/img/wings.png"
thumbnail: "assets/img/wings.png"
tags: [Automation, Object, Parsing, Cross Language]
excerpt_separator: <!--more-->
---

<!--more-->

I was working on a side project where I had the backend and frontend setup to run on different programming languages. As I was working on it, it started to bug me a little that I have to write the same object / struct and enum for each language in use everytime I introduce a new enum or struct. It can also be confusing / dangerous if I updated one side and forget to update the other.

At first, I just wrote some shell script to automate this but it quickly become unfeasible. (Clarification: it's still possible to do this, but without any sort of object oriented support, the code gets quite messy quickly and I didn't want to maintain that.) Now, at this point I should let you know that there are actually multiple existing solutions (Apache Thrift or Protobuf) that are way more matured, robust, and designed for use in a much larger scale. If you're working on an enterprise level solution (or looking to learn something that's more transferable into your future work), you might want to take look into them instead. I personally wanted something simpler and more flexible so I began working on [wings](https://wings.sh).

## Installation 

If you have nimble (comes with nim) installed, you can install wings with `nimble install wings`. As of now, the only alternative to that is to get the binary and place it in a folder included by the path (like `/usr/bin/`) which unfortunately means that it won't automatically update when a newer version is released. I'm still working on (and learning how to) deploy it to more package managers for easier installation process.

## Usage

You write a wings file like the example below then run `wings <FILENAME>.wings`.

<div class="highlight highlighter-rouge">
<pre class="highlight" id="codeblock">
  <code>
  <span class="kn">go-filepath</span> <span class="s">examples/go/classroom</span>
  <span class="kn">kt-filepath</span> <span class="s">examples/kt</span>
  <span class="kn">nim-filepath</span> <span class="s">examples/nim</span>
  <span class="kn">py-filepath</span> <span class="s">examples/py</span>
  <span class="kn">ts-filepath</span> <span class="s">examples/ts</span>

  <span class="kn">py-import</span> <span class="nx">examples.output.py.people</span>
  <span class="kn">ts-import</span> <span class="nx">{ IWingsStruct }</span><span class="kn">:</span><span class="kt">wings-ts-util</span>
  <span class="kn">import</span> <span class="s">examples/input/emotion.wings</span>
  <span class="kn">import</span> <span class="s">examples/input/homework.wings</span>

  <span class="kn">py-implement</span> <span class="nx">People</span>
  <span class="kn">ts-implement</span> <span class="nx">IWingsStruct</span>

  <span class="c1"># Any person who is studying in a class</span>

  <span class="kn">struct</span> <span class="nx">Student</span> <span class="kn">{</span>
    <span class="n">id</span>          <span class="kt">int</span>       <span class="mi">-1</span>
    <span class="n">name</span>        <span class="kt">str</span>
    <span class="n">cur_class</span>   <span class="kt">str</span>
    <span class="n">feeling</span>     <span class="nx">Emotion</span>   <span class="p">Emotion.Meh</span>
    <span class="n">is_active</span>   <span class="kt">bool</span>
    <span class="n">year</span>        <span class="kt">date</span>
    <span class="n">graduation</span>  <span class="kt">date</span>
    <span class="n">homeworks</span>   <span class="nx">[]Homework</span>
    <span class="n">something</span>   <span class="nx">Map<</span><span class="kt">str</span><span class="nx">,</span><span class="kt">str</span><span class="nx">></span>
  <span class="kn">}</span>

  <span class="nc">ts-func(</span>
    <span class="kt">public</span> <span class="nx">addHomework</span><span class="p">(</span><span class="nx">hw</span><span class="p">:</span> <span class="kt">Homework</span><span class="p">):</span> <span class="kn">void</span> <span class="p">{</span>
      <span class="kn">this</span><span class="kn">.</span><span class="nx">Homeworks</span><span class="kn">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hw</span><span class="p">)</span><span class="kn">;</span>
    <span class="p">}</span>
  <span class="nc">)</span>
  </code>
</pre>
</div>

As you can see, not only does it support generating files based on given specific parameters, it also supports importing other wings files directly which will also be generated by wings (unless specified otherwise in your config file).

## Library 

Since it's very beginning, wings has been published on nimble as a library for nim. With this, you will be able to make further customizations by importing it as a library especially if you only want to use a specific part of it. From there, you can even use build tools to incorporate it as part of your workflow if supported. (Shameless plug, I wrote the PR for please's basic [nim](https://github.com/thought-machine/pleasings/pull/29) and [nimble](https://github.com/thought-machine/pleasings/pull/31) support through pleasings. Though admittedly it isn't quite as complete as you can see here I use [my own version of the config](https://github.com/binhonglee/wings/blob/devel/build_defs/nim/nim.build_defs) in the repo.) 

I've also created [`stones`](https://github.com/binhonglee/stones), a separate library that contains some generic functions and tools used in wings. 

## Generated Files

### [Struct](https://wings.sh/#struct)

Unlike the afromentioned existing alternatives, it doesn't change the way the data was stored and transferred. You'll still be converting them from and to JSON and communicate through JSON (so they will still be human readable). Therefore, comparatively, it will be "slower" than the alternatives as it will inherit the same "slowness" of JSON (depending on how it is serialized and deserialized in each individual languages) and bulkiness (it's a pretty well established fact that JSON string takes more space in memory than something like a serialized thrift object). 

### [Enum](https://wings.sh/#enum)

Nothing much about them. They're just normal enums that starts from 0 and increment by 1 for each element in it. Custom type and initialization is in the works and might change up the syntax a little when support is added. 

## Util Classes

While the generated files (generally) work out of the box, they by themselves are still lacking of certain features that can be applied across all Struct or Enum classes. This is where the util classes comes in. They are written in each of their respective targeted languages as a package / library. Currently, there's only a Util class for TypeScript since golang already have all the features in the util class baked in with its JSON support. 

## [Config](https://wings.sh/config/)

While the use of a config file is optional, its also where the core value "customizable" comes from. Config files are accpeted in JSON format and should be added as an argument when calling wings with `-c:<CONFIG.json>`. Some of the more simple / straightforward configurable value includes things like [`logging`](https://wings.sh/config/#logging-int) which controls the verbosity of the output message in the terminal, [`skipImport`](https://wings.sh/config/#skipimport-bool) which lets you dictate if you'd want to also generate imported files or skip doing so, and [`header`](https://wings.sh/config/#header-str) which lets you specify your customized the header comment for all the generated files. On top of that, you can also configure how you want the output files to be formatted by specifying your own templates in [`langConfig`](https://wings.sh/config/#langconfigs-str) (more on this below).

## [Template](https://wings.sh/template/)

As mentioned above, you can also write your own or import someone else's templates (with [`remoteLangConfigs`](https://wings.sh/experimental/#remote-template)) to configure the output files in your own format or even to output to languages that are not officially supported. This allows wings to be used in a more dynamic way both in terms of range of supported languages and style format instead of being limited by what's officially supported (like in Thrift and protobuf though they do already have a wide range of support).

## Takeaways

Overall, I think one of the main takeaway is that if there's already an actively maintained existing solution, it's probably better to use that than to create your own. By now you might have realizes that this project is slowly morphing into something that looks similar to the existing alternatives but in a much simpler form. 

Admittedly, I've only started learning about how a programming language is written only after a few months into the project so the design and structure is not ideal. However, since this is also much simpler compared to a full blown programming language, I can still get away with it on this. That said, I might start to incorporate some of these principles into wings as I continue to work on it (including writing a proper lexer and parser for it). 

Of course, this is just a little side project spawn off of another side project. There's also the long time dilemma of "should I just write them manually or do I need to write codes (or use an external library) to write them" (the NIH syndrome). In this case the later took way more time than the former, but this is a side project so it's more about learning than meeting non-existent delivery dates anyway. I've also find it fun to have been working on the project so far and I hope you find this helpful. If you'd like to learn more about it (or use it yourself), check out the project website at [wings.sh](https://wings.sh). If you like what you've read, I'd appreciate a star on the [wings repository](https://github.com/binhonglee/wings).

---

## About me

I currently work at Facebook as a Software Engineer. I spend some of my free time experimenting and building new things with technologies I find fun and interesting. Follow my exploration journey [here](https://binhong.me/blog) or on [GitHub](https://github.com/binhonglee).
