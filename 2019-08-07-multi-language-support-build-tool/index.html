<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=0.75">
    
    <title>Multi-language Support Build Tool - BinHong Lee&#39;s Blog</title>
    
    <meta name="description" content="I recently started learning about Go to find out what‚Äôs all the hype about. So I figured what‚Äôs a better way than to build a project out of it? As I was setting up my machine and going through tutorials step-by-step, I was slightly annoyed by the fact that the development of Go projects are limited to inside the $GOPATH.
Personally, I have all my side projects stored at the top level of the computer. It might not be the best way to do it but I‚Äôm liking that I can see all my projects at one glance. I guess one could argue that you can soft link the folder into the folder inside $GOPATH and I would pretty much achieve the same effect. But it didn‚Äôt quite feel right to me, sounds like a really hacky workaround that might not worth the maintenance cost as I switch to a separate machine only to have to do everything all over again.">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Multi-language Support Build Tool">
    <meta property="og:description" content="Developing with Please">
    <meta name="twitter:description" content="Developing with Please">
    <meta name="twitter:title" content="Multi-language Support Build Tool"><meta property="article:published_time" 2019-08-07T00:00:00-08:00 />
    <meta property="article:modified_time" 2019-08-07T00:00:00-08:00 />
    <meta property="og:image" content="https://binhong.me/blog/preview/multi_language_build_tool.jpg">
    <meta property="og:image:height" content="600">
    <meta property="og:image:width" content="1200">
    <meta name="twitter:image" content="https://binhong.me/blog/preview/multi_language_build_tool.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="robots" content="max-image-preview:large">
    <meta name="image" content="https://binhong.me/blog/preview/multi_language_build_tool.jpg" />
    <meta name="twitter:site" content="@">
    <meta name="author" content="BinHong Lee">
    <meta property="og:profile:first_name" content="BinHong">
    <meta property="og:profile:last_name" content="Lee">
    <meta property="og:username" content="binhong">
    <meta property="og:locale" content="en_US">
    <meta property="og:site_name" content="BinHong Lee&#39;s Blog">
    <meta name="twitter:site" content="@binhonglee">
    <meta name="fediverse:creator" content="@bh@social.lol">
    <link href="https://social.lol/@bh" rel="me">
    
    <link href="https://binhong.me/blog/style.css?v=1754290957202" rel="stylesheet">
    <link href="https://binhong.me/blog/darkMode.css?v=1754287594183" rel="stylesheet">
    <link href="https://binhong.me/blog/dark-syntax.css?v=1754290957202" rel="stylesheet">
    <link href="https://binhong.me/blog/light-syntax.css?v=1754290957202" rel="stylesheet">
    <link href="https://binhong.me/fonts/fonts.css?v=1747738744" rel="stylesheet">
    <link href="https://binhong.me/threads/threads.css" rel="stylesheet">
    
    
    <link rel="icon" href="https://binhong.me/blog/img/profile.png" />
    
    <meta name="generator" content="Hugo 0.148.2">
    
    </head>
  <body class="single">
    <input class="dark_mode_toggle" type="checkbox" id="darkModeToggle">
    <div class="wrapper">
      <div class="content">
        <div class="dropdown">
          <button class="dropdown_toggle" aria-haspopup="true" aria-controls="dropdown_menu">+</button>
          <div class="header_links" id="dropdown_menu" aria-labelledby="dropdown_toggle" role="menu">
            <a class="link" href="https://binhong.me/" role="menuitem">About</a>
            <p>|</p>
            <a class="link" href="https://binhong.me/blog/" role="menuitem">Blog</a>
            <p>|</p>
            <div class="webring link" role="menuitem">
              <a class="webring_toggle">Webring</a>
              <div class="webring_links">
                <a class="link" href="https://ringdt.rapid.workers.dev/prev?from=https://binhong.me">Prev</a>
                <hr />
                <a class="link" href="https://ringdt.rapid.workers.dev/next?from=https://binhong.me">Next</a>    
              </div>
            </div>
          </div>
        </div>
        <div class="page_of_title">
          <div class="secondary_block">
            <p class="name-title">Blog</p>
          </div>
        </div>
        <div class="dark_mode_toggle_wrapper">
          <div class="toggle-container">
            <label for="darkModeToggle" class="toggle-label">
              <div class="background-layer day-bg"></div>
              <div class="background-layer night-bg"></div>
              
              <div class="toggle-slider">
                <div class="sun-rays"></div>
                <div class="moon-craters">
                  <div class="crater"></div>
                  <div class="crater"></div>
                  <div class="crater"></div>
                </div>
              </div>
              
              <div class="cloud cloud1"></div>
              <div class="cloud cloud2"></div>
              <div class="cloud cloud3"></div>
              <div class="cloud cloud4"></div>
              <div class="cloud cloud5"></div>
              
              <div class="star star1"></div>
              <div class="star star2"></div>
              <div class="star star3"></div>
              <div class="star star4"></div>
              <div class="star star5"></div>
              <div class="star star6"></div>
              <div class="star star7"></div>
              <div class="star star8"></div>
              <div class="star star9"></div>
              <div class="star star10"></div>
              <div class="star star11"></div>
              <div class="star star12"></div>
            </label>
          </div>
        </div>
      </div>


    <article class="content_body primary_block projects">
      <div class="img_class">
        <img class="thumbnail_img" src="https://binhong.me/blog/img/please.png">
      </div>
      <main class="article_body">
        <div class="active">
          <h1 class="row title">Multi-language Support Build Tool</h1>
          <p class="row subtitle">Developing with Please</p>
          <div class="row author">
            <p>BinHong Lee</p>
            <p class="right">August 7, 2019</p>
          </div>
          <div class="post_content"><p>I recently started learning about Go to find out what‚Äôs all the hype about. So I figured what‚Äôs a better way than to build a project out of it? As I was setting up my machine and going through tutorials step-by-step, I was slightly annoyed by the fact that the development of Go projects are limited to inside the <code>$GOPATH</code>.</p>
<p>Personally, I have all my side projects stored at the top level of the computer. It might not be the best way to do it but I‚Äôm liking that I can see all my projects at one glance. I guess one could argue that you can soft link the folder into the folder inside <code>$GOPATH</code> and I would pretty much achieve the same effect. But it didn‚Äôt quite feel right to me, sounds like a really hacky workaround that might not worth the maintenance cost as I switch to a separate machine only to have to do everything all over again.</p>
<p><em>*Note: Yes, I did eventually found out that you can now do development without being in <code>$GOPATH</code> with <code>go mod</code>.</em></p>
<p>Instead, I started looking into build tools that can do that. Admittedly, I intentionally picked something that‚Äôs not so mainstream (Buck, Bazel, Pants) and found Please. (The other part of me liked the idea of naming my run alias as <code>plz work</code> because it‚Äôs mildly funny.)</p>
<a class="anchor" href="#build-tools">
    <h2 id="build-tools">
        <span class="text">Build Tools</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>So what is a build tool and why do we need them? In most occasion of a side project, you build and run each part of your project separately in a package of its own with only one (or two) programming languages each. In which you never needed to cross compile or compile multiple projects at once in parallel. Even when you do, there‚Äôs nothing that needs more than a couple lines of shell scripts to string them together since the performance gain through parallel compiling is not that significant if at all.</p>
<p>However, this does not hold the same for companies that adopt the concept of monorepo. Instead of multiple smaller repositories, they host all of their code (which can be a mix of many different languages and requires many different build flows) in just a single repositories. In this case, different projects can also share the same library that is already imported and in use by the other project thus making sure that the imported library version is always consistent across all the projects.</p>
<p>Here‚Äôs a quick summary of why and why not. I‚Äôm not here to debate if you should or should not use a build tool or monorepo. I‚Äôll leave them to the experts. I‚Äôm just here to share about the possibility of doing so.</p>
<p>Advantages:</p>
<ul>
<li>Multi-language compatibility</li>
<li>Not limited to any specific path</li>
<li>Consistently work across supported devices</li>
<li>Smoother e2e workflow (if set up correctly)</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Slightly steeper learning curve</li>
<li>Can be complicated to set them up</li>
</ul>
<a class="anchor" href="#installation">
    <h2 id="installation">
        <span class="text">Installation</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>There are a few pretty straightforward way to install it according to their <a href="https://please.build/quickstart.html">documentation</a> though admittedly, you probably shouldn‚Äôt just run some random script from some random website online (but then again, compiling from source can be a bit of a pain) so that‚Äôs really up to you.</p>
<p><em>*Note: You mostly only need this installed to initialize the project. Others wanting to build / develop the project does not necessarily have to have <code>please</code> installed locally for them. Similar to how Gradle works with <code>./gradlew</code> on machines without Gradle installed, Please generates a <code>./pleasew</code> file that can be ran as an alternative if one does not have Please installed in the machine.</em></p>
<a class="anchor" href="#setup">
    <h2 id="setup">
        <span class="text">Setup</span>
        <span class="tag">#</span>
    </h2>
</a>
<a class="anchor" href="#build-files">
    <h3 id="build-files">
        <span class="text">BUILD files</span>
        <span class="tag">#</span>
    </h3>
</a>
<p>Honestly the BUILD file syntax for Please looks very much alike (if not identical) to some of the other more popular build tools like Bazel or Buck. I don‚Äôt know of the exact name for it but it is very Python-ish. In fact, GitHub linguist‚Äôs <code>language.yml</code> actually explicitly <a href="https://github.com/github/linguist/blob/master/lib/linguist/languages.yml#L4001-L4003">classifies them as Python</a>. I recommend checking out <a href="https://please.build/lexicon.html">the documentation</a> as they are pretty good in detailing the available fields and their purpose for it.</p>
<a class="anchor" href="#external-dependencies">
    <h3 id="external-dependencies">
        <span class="text">External Dependencies</span>
        <span class="tag">#</span>
    </h3>
</a>
<p>This is probably the most tedious part of the whole process. It makes you realize how much have you‚Äôve taken tools like <code>dep</code> or even <code>npm</code> and <code>yarn</code> for granted. Unlike those other tools I‚Äôve mentioned, you‚Äôll have to manually list each and every one of the external dependencies (and their dependencies) properly so Please knows which to prioritize and how to build and manage them in the most efficient parallel way. Fortunately, this should be a one time thing as even if you consistently increase dependencies, chances are you already have the dependencies of the new dependencies listed.</p>
<a class="anchor" href="#code-structure">
    <h2 id="code-structure">
        <span class="text">Code Structure</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>You have a lot of freedom here. While you might not want to go crazy and have your code all over the place (making them referencing each other a nightmare), you can afford to structure them slightly different from the conventional way since the build tool will handle the hierarchical setup for you. For instance, you can have your main go file 2 levels (or more) inside some folder unlike the usual top level requirements. Similarly, if you need some folders of multiple different programming languages to overlap in between each other, that‚Äôs pretty possible (though I would question the need for it and if there‚Äôs a rational reasoning behind it).</p>
<hr>
<a class="anchor" href="#pleasings">
    <h2 id="pleasings">
        <span class="text">pleasings</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>Aside from the built-in supported languages and rules, they also have an additional repository that is home to the rules that are not actively maintained / updated thus not being part of the core functionality / rule. These includes support for things like Android, Rust, Scala, Kotlin and even Nim (okay, I wrote the one for Nim so I‚Äôm just shamelessly sneaking it in here).</p>
<a class="anchor" href="#genrule--gentest">
    <h2 id="genrule--gentest">
        <span class="text">genrule() / gentest()</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>Even with pleasings, there‚Äôs a possibility where there‚Äôs something you work on (or need for your project) that is not supported. In my project, I‚Äôm also compiling Vue.js code for the web. In this case, I used a genrule() to build it with pnpm (similar to npm and yarn) and a gentest() to run its tests. While it‚Äôs pretty straightforward to do it this way, I‚Äôve also effectively reduced the benefits of using a build tool since I‚Äôm mostly waiting on this one rule (and rely on pnpm‚Äôs build efficiency instead of Please‚Äôs) when building my entire project. Here is an example how I did mine:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">genrule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;pnpm&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">visibility</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PUBLIC&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;node_modules&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39; &amp;&amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;top_level=$(pwd | awk -F&#39;plz-out&#39; &#39;{print $1}&#39;)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;pnpm i&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ln -s </span><span class="se">\&#34;</span><span class="s2">$top_level</span><span class="se">\&#34;\&#34;</span><span class="s2">node_modules</span><span class="se">\&#34;</span><span class="s2"> </span><span class="se">\&#34;</span><span class="s2">node_modules</span><span class="se">\&#34;</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">]),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">genrule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;build&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">outs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39; &amp;&amp; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;current=$(pwd)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;cd $(pwd | awk -F&#39;plz-out&#39; &#39;{print $1}&#39;)&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;pnpm run build&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;mv </span><span class="se">\&#34;</span><span class="s2">dist</span><span class="se">\&#34;</span><span class="s2"> </span><span class="se">\&#34;</span><span class="s2">$current</span><span class="se">\&#34;</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]),</span>
</span></span><span class="line"><span class="cl">    <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;:pnpm&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>*Note: Please do have <a href="https://github.com/thought-machine/pleasings/tree/master/js">some support for JavaScript</a> in the <code>pleasings</code> repository in which you can use their <code>yarn_library()</code> and <code>js_binary()</code>. However due to the nature of node.js dependency hell nowadays, handwriting the <code>yarn_library()</code> rules for all the libraries you want + all the libraries those libraries depends on and so forth will probably take forever. I also did not look too deep into this to tell if this would work any differently from just running <code>yarn install</code> just by itself.</p>
<hr>
<a class="anchor" href="#ci-testing">
    <h2 id="ci-testing">
        <span class="text">CI Testing</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>One of the other benefit of having a build tool properly set up is that it would be slightly easier (and more consistent) to set up your CI testing both in terms of testing environment and testing outcome. Of course, there are still some external dependencies like language version installed etc but for the most part, build tools would always pull fresh version of the new build regardless if there is a cached version on the machine (that might mess with the consistency of the test result).</p>
<a class="anchor" href="#vscode">
    <h2 id="vscode">
        <span class="text">VSCode</span>
        <span class="tag">#</span>
    </h2>
</a>
<p>For most code editors, their linter will rely on the env value of <code>$GOPATH</code> to look for third party libraries used in your go codes. Since those libraries don‚Äôt live in there when building with Please (it is in the <code>plz-out</code> folder inside your project folder), you will want to have a <code>settings.json</code> file that points the linter to the right location consisting of the compiled libraries. Something like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;go.inferGopath&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;go.gopath&#34;</span><span class="p">:</span> <span class="s2">&#34;{workplaceFolder}/plz-out/go:/{workplaceFolder}/plz-out/go/src&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;files.watcherExclude&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;**/plz-out/**&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><em>*Note: you will want to replace <code>{workplaceFolder}</code> with an absolute path to wherever your project lives since the linter seems to complain about using a relative path as <code>$GOPATH</code>.</em></p>
<hr>
<p>Hopefully this has been helpful in opening you up to trying and mixing different programming languages into your project. Why? To me, side projects are just experimental grounds for fun. If it sounds interesting enough, I‚Äôll try and make it happen (or in this case, see if someone has done it and use their ready build tool).</p>
<p>If you are interested, <a href="https://github.com/binhonglee/GlobeTrotte/">this</a> is the side project I‚Äôve been working on. Thus far, its still not functional. It will most likely take another few months or so (depending on my progress and how much free time I have committed to this outside of work) before I can deploy a minimally working version of it.</p>
</div>
          <div class="tags">
            üîñ
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/build">Build</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/devops">DevOps</a>
            <a style="border-radius: 5px; border-style: solid; border-width: 1px;" class="tag" href="https://binhong.me/blog/tags/automation">Automation</a>
          </div>
        </div>        <div class="newsletter">
          <h2>Subscribe to the newsletter today!</h2>
          <form action="https://binhong.me/newsletter/subscribe" method="post">
              <input type="email" name="email" placeholder="email@domain.com"/>
              <noscript>
                <br />
                <label>You will need to manually get this secret from <a href="https://binhong.me/newsletter/secret">here</a></label>
                <input name="secret" placeholder="secret"/>
                <br />
              </noscript>
              <input type="hidden" name="secret" id="secret" value="123potato123"/>
              <button type="submit" name="submit" class="subscribe">Subscribe</button>
          </form>
          You can also checkout previous issues <a href="https://binhong.me/newsletter" target="_blank" style="text-decoration: underline;">here</a> before deciding.
        </div>
        <div class="bottom_buttons">
          
          
          
          <a href="/blog/2020-08-09-cross-language-object-parsing/">
            <div class="bottom_button">
              ‚Üê Next
              <br />
              <br />
              <span class="button_title">Cross Language Object Parsing</span>
            </div>
          </a>
          
          
          
          <a href="/blog/2019-05-07-shell-scripting/">
            <div class="bottom_button previous_post">
              Previous ‚Üí
              <br />
              <br />
              <span class="button_title">Functional and flexible shell scripting tricks</span>
            </div>
          </a>
          
        </div>
      </main>
    </article>
      <footer class="content">
        <div class="footer primary_block">
          <div class="row">
            <p>Fonts:</p>
            <a href="http://vollkorn-typeface.com/" rel="noopener noreferrer nofollow" target="_blank" class="name">Vollkorn</a>,
            <a href="https://rubjo.github.io/victor-mono/" rel="noopener noreferrer nofollow" target="_blank" class="name">Victor Mono</a>
          </div>
          <div class="row">
            <p>
              <a href="https://github.com/binhonglee/blog/blob/main/content/2019-08-07-multi-language-support-build-tool.md?plain=1" rel="noopener noreferrer nofollow" target="_blank">Source</a>
              |
              <a rel="alternate" type="application/rss+xml" href="https://binhong.me/blog/index.xml" title="BinHong Lee&#39;s Blog">RSS</a>
            </p>
          </div>
          <div class="row">
            <p>
              &copy; 2025 <a href="https://binhong.me">BinHong Lee</a>
            </p>
          </div>
          <div class="row">
            <p>
              Powered by <a href="https://gohugo.io/" rel="noopener noreferrer nofollow" target="_blank">Hugo</a>
            </p>
          </div>
        </div>
      </footer>
    </div>
    <script type="text/javascript" src="https://binhong.me/darkMode.js"></script>
    <script type="text/javascript" src="https://binhong.me/viewer.js"></script>
    <script type="text/javascript" src="https://binhong.me/blog/secret.js"></script>
  </body>
</html>

